generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                     String   @id @default(uuid()) @db.Char(36)
  userId                 String   @unique @map("user_id") @db.VarChar(255)
  passwordHash           String   @map("password_hash") @db.VarChar(255)
  name                   String   @db.VarChar(100)
  hospitalName           String?  @map("hospital_name") @db.VarChar(100)
  hospitalEmail          String?  @map("hospital_email") @db.VarChar(255)
  taxEmail               String?  @map("tax_email") @db.VarChar(255)
  phone                  String?  @db.VarChar(20)
  mobile                 String?  @db.VarChar(20)
  businessNumber         String?  @map("business_number") @db.VarChar(50)
  zipCode                String?  @map("zip_code") @db.VarChar(10)
  address                String?  @db.Text
  addressDetail          String?  @map("address_detail") @db.Text
  region                 String?  @db.VarChar(100)
  businessCertificateUrl String?  @map("business_certificate_url") @db.Text
  emailNotification      Boolean  @default(false) @map("email_notification")
  holidayWeek            String?  @map("holiday_week") @db.VarChar(50)
  holidayDay             String?  @map("holiday_day") @db.VarChar(50)
  isPublicHoliday        Boolean  @default(false) @map("is_public_holiday")
  role                   Role     @default(user)
  createdAt              DateTime @default(now()) @map("created_at")

  userEquipments UserEquipment[]
  cartItems      CartItem[]
  orders         Order[]
  inquiries      Inquiry[]

  @@map("users")
}

enum Role {
  admin
  user
}

model Equipment {
  id        String   @id @default(uuid()) @db.Char(36)
  modelName String   @map("model_name") @db.VarChar(100)
  code      String?  @unique @db.VarChar(50)
  category  String?  @db.VarChar(50)
  imageUrl  String?  @map("image_url") @db.Text
  createdAt DateTime @default(now()) @map("created_at")

  userEquipments         UserEquipment[]
  productCompatibilities ProductCompatibility[]

  @@map("equipments")
}

model UserEquipment {
  id              String    @id @default(uuid()) @db.Char(36)
  userId          String    @map("user_id") @db.Char(36)
  equipmentId     String    @map("equipment_id") @db.Char(36)
  serialNumber    String?   @map("serial_number") @db.VarChar(100)
  installDate     DateTime? @map("install_date") @db.Date
  warrantyEndDate DateTime? @map("warranty_end_date") @db.Date
  createdAt       DateTime  @default(now()) @map("created_at")

  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  equipment Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)

  @@map("user_equipments")
}

model Product {
  id          String   @id @default(uuid()) @db.Char(36)
  sku         String   @unique @db.VarChar(100)
  name        String   @db.VarChar(255)
  category    String?  @db.VarChar(50)
  subcategory String?  @db.VarChar(50)
  description String?  @db.Text
  price       Int      @default(0)
  stock       Int      @default(0)
  imageUrl    String?  @map("image_url") @db.Text
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")

  images          ProductImage[]
  pricingTiers    ProductPricingTier[]
  compatibilities ProductCompatibility[]
  cartItems       CartItem[]
  orderItems      OrderItem[]

  @@map("products")
}

model ProductImage {
  id           String @id @default(uuid()) @db.Char(36)
  productId    String @map("product_id") @db.Char(36)
  imageUrl     String @map("image_url") @db.Text
  displayOrder Int    @default(0) @map("display_order")

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_images")
}

model ProductPricingTier {
  id          String @id @default(uuid()) @db.Char(36)
  productId   String @map("product_id") @db.Char(36)
  minQuantity Int    @map("min_quantity")
  unitPrice   Int    @map("unit_price")

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_pricing_tiers")
}

model ProductCompatibility {
  id          String @id @default(uuid()) @db.Char(36)
  productId   String @map("product_id") @db.Char(36)
  equipmentId String @map("equipment_id") @db.Char(36)

  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  equipment Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)

  @@map("product_compatibility")
}

model CartItem {
  id             String   @id @default(uuid()) @db.Char(36)
  userId         String   @map("user_id") @db.Char(36)
  productId      String   @map("product_id") @db.Char(36)
  quantity       Int      @default(1)
  isSubscription Boolean  @default(false) @map("is_subscription")
  createdAt      DateTime @default(now()) @map("created_at")

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("cart_items")
}

model Order {
  id              String      @id @default(uuid()) @db.Char(36)
  userId          String?     @map("user_id") @db.Char(36)
  orderNumber     String      @unique @map("order_number") @db.VarChar(100)
  status          OrderStatus @default(pending)
  totalAmount     Int         @map("total_amount")
  paymentMethod   String?     @map("payment_method") @db.VarChar(50)
  deliveryAddress String?     @map("delivery_address") @db.Text
  trackingNumber  String?     @map("tracking_number") @db.VarChar(100)
  orderedAt       DateTime    @default(now()) @map("ordered_at")
  updatedAt       DateTime    @default(now()) @updatedAt @map("updated_at")

  user  User?       @relation(fields: [userId], references: [id], onDelete: SetNull)
  items OrderItem[]

  @@map("orders")
}

enum OrderStatus {
  pending
  paid
  processing
  shipped
  delivered
  cancelled
}

model OrderItem {
  id         String  @id @default(uuid()) @db.Char(36)
  orderId    String  @map("order_id") @db.Char(36)
  productId  String? @map("product_id") @db.Char(36)
  quantity   Int
  unitPrice  Int     @map("unit_price")
  totalPrice Int     @map("total_price")

  order   Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product? @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@map("order_items")
}

model Post {
  id        String   @id @default(uuid()) @db.Char(36)
  type      PostType
  title     String   @db.VarChar(255)
  content   String?  @db.Text
  viewCount Int      @default(0) @map("view_count")
  isVisible Boolean  @default(true) @map("is_visible")
  imageUrl  String?  @map("image_url") @db.Text
  createdAt DateTime @default(now()) @map("created_at")

  @@map("posts")
}

enum PostType {
  notice
  faq
  news
  media
}

model Inquiry {
  id            String        @id @default(uuid()) @db.Char(36)
  userId        String?       @map("user_id") @db.Char(36)
  type          String        @db.VarChar(50)
  title         String        @db.VarChar(255)
  content       String        @db.Text
  isSecret      Boolean       @default(true) @map("is_secret")
  status        InquiryStatus @default(waiting)
  answerContent String?       @map("answer_content") @db.Text
  answeredAt    DateTime?     @map("answered_at")
  createdAt     DateTime      @default(now()) @map("created_at")

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@map("inquiries")
}

enum InquiryStatus {
  waiting
  answered
}
